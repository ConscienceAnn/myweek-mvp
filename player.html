<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üé¨ –¢–≤–æ—è –Ω–µ–¥–µ–ª—è –∫–∞–∫...</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #imageContainer {
            width: 100%;
            max-width: 600px;
            height: auto;
            background: #000;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .image-slide {
            position: absolute;
            width: 100%;
            height: auto;
            object-fit: contain;
            opacity: 0;
            transition: none;
        }
        .active {
            opacity: 1;
            z-index: 2;
        }
        .incoming {
            animation: windSwipeIn 1s ease-out forwards;
            z-index: 3;
        }
        .outgoing {
            animation: windSwipeOut 0.8s ease-in forwards;
            z-index: 1;
        }
        @keyframes windSwipeIn {
            0% {
                transform: translateX(100%) rotate(5deg);
                opacity: 0;
                filter: blur(10px);
            }
            30% {
                transform: translateX(30%) rotate(2deg);
                opacity: 0.7;
                filter: blur(5px);
            }
            60% {
                transform: translateX(-10%) rotate(-1deg);
                opacity: 1;
                filter: blur(2px);
            }
            100% {
                transform: translateX(0) rotate(0);
                opacity: 1;
                filter: blur(0);
            }
        }
        @keyframes windSwipeOut {
            0% {
                transform: translateX(0) rotate(0);
                opacity: 1;
                filter: blur(0);
            }
            40% {
                transform: translateX(-20%) rotate(-2deg);
                opacity: 0.7;
                filter: blur(3px);
            }
            70% {
                transform: translateX(-60%) rotate(-5deg);
                opacity: 0.3;
                filter: blur(6px);
            }
            100% {
                transform: translateX(-100%) rotate(-8deg);
                opacity: 0;
                filter: blur(10px);
            }
        }
        #startButton {
            padding: 15px 30px;
            font-size: 18px;
            background: #ff5e5b;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            position: absolute;
            z-index: 10;
        }
        #shareBtn, #restartBtn {
            padding: 12px 24px;
            margin: 10px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        #shareBtn { background: #ff5e5b; color: white; }
        #restartBtn { background: #4CAF50; color: white; }
    </style>
</head>
<body>
    <div id="playerContainer">
        <div id="imageContainer">
            <img id="currentImage" class="image-slide" alt="–¢–≤–æ—è –Ω–µ–¥–µ–ª—è">
            <button id="startButton">‚ñ∂Ô∏è –ù–∞–∂–º–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</button>
        </div>
    </div>

    <script>
        const BASE_URL = "https://conscienceann.github.io/myweek-mvp/images/";

        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('id') || 'test123';

        const mood1 = urlParams.get('m1') || '1';
        const mood2 = urlParams.get('m2') || '2';
        const mood3 = urlParams.get('m3') || '3';

        const imageMap = {
            intro: `${BASE_URL}intro.jpg`,
            mood_1: `${BASE_URL}mood_1.jpg`,
            mood_2: `${BASE_URL}mood_2.jpg`,
            mood_3: `${BASE_URL}mood_3.jpg`,
            outro: `${BASE_URL}outro.jpg`
        };

        const sequence = [
            'intro',
            `mood_${mood1}`,
            `mood_${mood2}`,
            `mood_${mood3}`,
            'outro'
        ];

        let currentImageIndex = 0;
        const imageContainer = document.getElementById('imageContainer');
        const startButton = document.getElementById('startButton');

        // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞ –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
        const DISPLAY_DURATION = 3000; // 3 —Å–µ–∫—É–Ω–¥—ã
        let imageTimer = null;

        function showNextImage() {
            if (currentImageIndex >= sequence.length) {
                showEndScreen();
                return;
            }

            const key = sequence[currentImageIndex];
            const url = imageMap[key];

            if (!url) {
                console.error(`–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: ${key}`);
                currentImageIndex++;
                showNextImage();
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const newImage = document.createElement('img');
            newImage.className = 'image-slide';
            newImage.alt = '–¢–≤–æ—è –Ω–µ–¥–µ–ª—è';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            newImage.onload = function() {
                // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–µ–µ –∞–∫—Ç–∏–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const currentActive = document.querySelector('.image-slide.active');
                
                if (currentActive) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—ã—Ö–æ–¥–∞
                    currentActive.classList.remove('active');
                    currentActive.classList.add('outgoing');
                    
                    // –£–¥–∞–ª—è–µ–º –µ–≥–æ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                    setTimeout(() => {
                        if (currentActive.parentNode) {
                            currentActive.remove();
                        }
                    }, 800);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                imageContainer.appendChild(newImage);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤—Ö–æ–¥–∞ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                setTimeout(() => {
                    newImage.classList.add('incoming');
                    
                    // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—Ö–æ–¥–∞ –¥–µ–ª–∞–µ–º –µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã–º
                    setTimeout(() => {
                        newImage.classList.remove('incoming');
                        newImage.classList.add('active');
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                        imageTimer = setTimeout(() => {
                            currentImageIndex++;
                            showNextImage();
                        }, DISPLAY_DURATION);
                    }, 1000);
                }, 50);
            };
            
            newImage.onerror = function() {
                console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${url}`);
                currentImageIndex++;
                showNextImage();
            };
            
            newImage.src = url;
        }

        function showEndScreen() {
            // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (imageTimer) {
                clearTimeout(imageTimer);
            }
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const images = document.querySelectorAll('.image-slide');
            images.forEach(img => img.remove());
            
            imageContainer.innerHTML = `
                <div style="color: white; text-align: center; padding: 20px;">
                    <h2>üé¨ –¢–≤–æ—è –Ω–µ–¥–µ–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
                    <button id="shareBtn">üì≤ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                    <button id="restartBtn">üîÑ –ù–æ–≤–∞—è –Ω–µ–¥–µ–ª—è</button>
                </div>
            `;

            document.getElementById('shareBtn').addEventListener('click', shareResult);
            document.getElementById('restartBtn').addEventListener('click', () => {
                window.location.href = window.location.origin + window.location.pathname;
            });
        }

        function shareResult() {
            const shareText = `–ú–û–Ø –ù–ï–î–ï–õ–Ø –ö–ê–ö...\n–ü–Ω: –∫–∞–∫ —Ç–µ–ª–µ—Ñ–æ–Ω —Å 3% üì±\n–í—Ç: –∫–∞–∫ –∫–æ—Ç –Ω–∞ —Å–æ–ª–Ω—Ü–µ üê±\n–°—Ä: –∫–∞–∫ –≥–µ—Ä–æ–π üéÆ\n#–ú–æ—è–ù–µ–¥–µ–ª—è–ö–∞–∫\n${window.location.href}`;
            if (navigator.share) {
                navigator.share({ title: '–ú–æ—è –Ω–µ–¥–µ–ª—è –∫–∞–∫...', text: shareText });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –í—Å—Ç–∞–≤—å –≤ —á–∞—Ç –∏–ª–∏ —Å—Ç–æ—Ä–∏—Å ‚úÖ");
                }).catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                });
            }
        }

        startButton.addEventListener('click', () => {
            startButton.style.display = 'none';
            showNextImage();
        });
    </script>
</body>
</html>