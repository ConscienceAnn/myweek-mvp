<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üé¨ –¢–≤–æ—è –Ω–µ–¥–µ–ª—è –∫–∞–∫...</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #imageContainer {
            width: 100%;
            max-width: 600px;
            height: auto;
            background: #000;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .image-slide {
            position: absolute;
            width: 100%;
            height: auto;
            object-fit: contain;
            opacity: 0;
            transition: none;
        }
        .active {
            opacity: 1;
            z-index: 2;
        }
        .incoming {
            animation: windSwipeIn 1s ease-out forwards;
            z-index: 3;
        }
        .outgoing {
            animation: windSwipeOut 0.8s ease-in forwards;
            z-index: 1;
        }
        @keyframes windSwipeIn {
            0% {
                transform: translateX(100%) rotate(5deg);
                opacity: 0;
                filter: blur(10px);
            }
            30% {
                transform: translateX(30%) rotate(2deg);
                opacity: 0.7;
                filter: blur(5px);
            }
            60% {
                transform: translateX(-10%) rotate(-1deg);
                opacity: 1;
                filter: blur(2px);
            }
            100% {
                transform: translateX(0) rotate(0);
                opacity: 1;
                filter: blur(0);
            }
        }
        @keyframes windSwipeOut {
            0% {
                transform: translateX(0) rotate(0);
                opacity: 1;
                filter: blur(0);
            }
            40% {
                transform: translateX(-20%) rotate(-2deg);
                opacity: 0.7;
                filter: blur(3px);
            }
            70% {
                transform: translateX(-60%) rotate(-5deg);
                opacity: 0.3;
                filter: blur(6px);
            }
            100% {
                transform: translateX(-100%) rotate(-8deg);
                opacity: 0;
                filter: blur(10px);
            }
        }
        
        /* Glitch + RGB Split —ç—Ñ—Ñ–µ–∫—Ç */
        .glitch-container {
            position: relative;
            width: 100%;
            height: auto;
            overflow: hidden;
        }
        
        .glitch-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            mix-blend-mode: lighten;
        }
        
        .glitch-red {
            filter: hue-rotate(0deg) saturate(300%);
            left: 2px;
            opacity: 0.8;
        }
        
        .glitch-blue {
            filter: hue-rotate(240deg) saturate(300%);
            left: -2px;
            opacity: 0.8;
        }
        
        .glitch-main {
            position: relative;
            z-index: 1;
        }
        
        .glitch-active .glitch-main {
            animation: glitch-main 0.4s linear forwards;
        }
        
        .glitch-active .glitch-red,
        .glitch-active .glitch-blue {
            animation: glitch-color 0.4s linear infinite;
            display: block;
        }
        
        @keyframes glitch-main {
            0%, 100% { transform: translate(0); filter: none; }
            10% { transform: translate(-2px, 2px); filter: contrast(150%) brightness(120%); }
            20% { transform: translate(2px, -2px); filter: contrast(150%) brightness(120%); }
            30% { transform: translate(-2px, -2px); filter: contrast(150%) brightness(120%); }
            40% { transform: translate(2px, 2px); filter: contrast(150%) brightness(120%); }
            50% { transform: translate(-2px, 0); filter: contrast(150%) brightness(120%); }
            60% { transform: translate(2px, 0); filter: contrast(150%) brightness(120%); }
            70% { transform: translate(0, 2px); filter: contrast(150%) brightness(120%); }
            80% { transform: translate(0, -2px); filter: contrast(150%) brightness(120%); }
            90% { transform: translate(0, 0); filter: contrast(150%) brightness(120%); }
        }
        
        @keyframes glitch-color {
            0% { clip-path: inset(10% 0 90% 0); }
            10% { clip-path: inset(20% 0 80% 0); }
            20% { clip-path: inset(30% 0 70% 0); }
            30% { clip-path: inset(40% 0 60% 0); }
            40% { clip-path: inset(50% 0 50% 0); }
            50% { clip-path: inset(60% 0 40% 0); }
            60% { clip-path: inset(70% 0 30% 0); }
            70% { clip-path: inset(80% 0 20% 0); }
            80% { clip-path: inset(90% 0 10% 0); }
            90% { clip-path: inset(100% 0 0 0); }
            100% { clip-path: inset(0 0 100% 0); }
        }
        
        #startButton {
            padding: 15px 30px;
            font-size: 18px;
            background: #ff5e5b;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            position: absolute;
            z-index: 10;
        }
        #shareBtn, #restartBtn {
            padding: 12px 24px;
            margin: 10px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        #shareBtn { background: #ff5e5b; color: white; }
        #restartBtn { background: #4CAF50; color: white; }
    </style>
</head>
<body>
    <div id="playerContainer">
        <div id="imageContainer">
            <div id="glitchWrapper" class="glitch-container">
                <img id="currentImage" class="image-slide glitch-main" alt="–¢–≤–æ—è –Ω–µ–¥–µ–ª—è">
                <img class="image-slide glitch-layer glitch-red" style="display: none;" alt="red layer">
                <img class="image-slide glitch-layer glitch-blue" style="display: none;" alt="blue layer">
            </div>
            <button id="startButton">‚ñ∂Ô∏è –ù–∞–∂–º–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</button>
        </div>
    </div>

    <script>
        const BASE_URL = "https://conscienceann.github.io/myweek-mvp/images/";

        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('id') || 'test123';

        const mood1 = urlParams.get('m1') || '1';
        const mood2 = urlParams.get('m2') || '2';
        const mood3 = urlParams.get('m3') || '3';

        const imageMap = {
            intro: `${BASE_URL}intro.jpg`,
            mood_1: `${BASE_URL}mood_1.jpg`,
            mood_2: `${BASE_URL}mood_2.jpg`,
            mood_3: `${BASE_URL}mood_3.jpg`,
            outro: `${BASE_URL}outro.jpg`
        };

        const sequence = [
            'intro',
            `mood_${mood1}`,
            `mood_${mood2}`,
            `mood_${mood3}`,
            'outro'
        ];

        let currentImageIndex = 0;
        const imageContainer = document.getElementById('imageContainer');
        const glitchWrapper = document.getElementById('glitchWrapper');
        const startButton = document.getElementById('startButton');
        const currentImage = document.getElementById('currentImage');
        const redLayer = document.querySelector('.glitch-red');
        const blueLayer = document.querySelector('.glitch-blue');

        // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞ –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
        const DISPLAY_DURATION = 3000; // 3 —Å–µ–∫—É–Ω–¥—ã
        let imageTimer = null;

        function showNextImage() {
            if (currentImageIndex >= sequence.length) {
                showEndScreen();
                return;
            }

            const key = sequence[currentImageIndex];
            const url = imageMap[key];

            if (!url) {
                console.error(`–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: ${key}`);
                currentImageIndex++;
                showNextImage();
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const newImage = document.createElement('img');
            newImage.className = 'image-slide glitch-main';
            newImage.alt = '–¢–≤–æ—è –Ω–µ–¥–µ–ª—è';
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è glitch —ç—Ñ—Ñ–µ–∫—Ç–∞
            const newGlitchWrapper = document.createElement('div');
            newGlitchWrapper.className = 'glitch-container';
            
            // –°–æ–∑–¥–∞–µ–º —Å–ª–æ–∏ –¥–ª—è glitch —ç—Ñ—Ñ–µ–∫—Ç–∞
            const newRedLayer = document.createElement('img');
            newRedLayer.className = 'image-slide glitch-layer glitch-red';
            newRedLayer.style.display = 'none';
            
            const newBlueLayer = document.createElement('img');
            newBlueLayer.className = 'image-slide glitch-layer glitch-blue';
            newBlueLayer.style.display = 'none';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            newImage.onload = function() {
                // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                const currentActiveWrapper = document.querySelector('.glitch-container.active');
                
                if (currentActiveWrapper) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—ã—Ö–æ–¥–∞
                    currentActiveWrapper.classList.remove('active');
                    currentActiveWrapper.classList.add('outgoing');
                    
                    // –£–¥–∞–ª—è–µ–º –µ–≥–æ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                    setTimeout(() => {
                        if (currentActiveWrapper.parentNode) {
                            currentActiveWrapper.remove();
                        }
                    }, 800);
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º src –¥–ª—è –≤—Å–µ—Ö —Å–ª–æ–µ–≤
                newRedLayer.src = url;
                newBlueLayer.src = url;
                
                // –°–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                newGlitchWrapper.appendChild(newImage);
                newGlitchWrapper.appendChild(newRedLayer);
                newGlitchWrapper.appendChild(newBlueLayer);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ DOM
                imageContainer.appendChild(newGlitchWrapper);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤—Ö–æ–¥–∞ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                setTimeout(() => {
                    newGlitchWrapper.classList.add('incoming');
                    
                    // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—Ö–æ–¥–∞ –¥–µ–ª–∞–µ–º –µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã–º
                    setTimeout(() => {
                        newGlitchWrapper.classList.remove('incoming');
                        newGlitchWrapper.classList.add('active');
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ –≤—Ç–æ—Ä–æ–π –∫–∞–¥—Ä (–∏–Ω–¥–µ–∫—Å 2 –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Ç.–∫. –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å 0, –∏ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç - intro)
                        if (currentImageIndex === 2) {
                            // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç glitch —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            setTimeout(() => {
                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–æ–∏ glitch
                                newRedLayer.style.display = 'block';
                                newBlueLayer.style.display = 'block';
                                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                                newGlitchWrapper.classList.add('glitch-active');
                                
                                // –ß–µ—Ä–µ–∑ 0.4 —Å–µ–∫—É–Ω–¥—ã —É–±–∏—Ä–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
                                setTimeout(() => {
                                    newGlitchWrapper.classList.remove('glitch-active');
                                    newRedLayer.style.display = 'none';
                                    newBlueLayer.style.display = 'none';
                                    currentImageIndex++;
                                    showNextImage();
                                }, 400);
                            }, 1000); // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —ç—Ñ—Ñ–µ–∫—Ç–∞
                        } else {
                            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            imageTimer = setTimeout(() => {
                                currentImageIndex++;
                                showNextImage();
                            }, DISPLAY_DURATION);
                        }
                    }, 1000);
                }, 50);
            };
            
            newImage.onerror = function() {
                console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${url}`);
                currentImageIndex++;
                showNextImage();
            };
            
            newImage.src = url;
        }

        function showEndScreen() {
            // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (imageTimer) {
                clearTimeout(imageTimer);
            }
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
            const containers = document.querySelectorAll('.glitch-container');
            containers.forEach(container => container.remove());
            
            imageContainer.innerHTML = `
                <div style="color: white; text-align: center; padding: 20px;">
                    <h2>üé¨ –¢–≤–æ—è –Ω–µ–¥–µ–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
                    <button id="shareBtn">üì≤ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                    <button id="restartBtn">üîÑ –ù–æ–≤–∞—è –Ω–µ–¥–µ–ª—è</button>
                </div>
            `;

            document.getElementById('shareBtn').addEventListener('click', shareResult);
            document.getElementById('restartBtn').addEventListener('click', () => {
                window.location.href = window.location.origin + window.location.pathname;
            });
        }

        function shareResult() {
            const shareText = `–ú–û–Ø –ù–ï–î–ï–õ–Ø –ö–ê–ö...\n–ü–Ω: –∫–∞–∫ —Ç–µ–ª–µ—Ñ–æ–Ω —Å 3% üì±\n–í—Ç: –∫–∞–∫ –∫–æ—Ç –Ω–∞ —Å–æ–ª–Ω—Ü–µ üê±\n–°—Ä: –∫–∞–∫ –≥–µ—Ä–æ–π üéÆ\n#–ú–æ—è–ù–µ–¥–µ–ª—è–ö–∞–∫\n${window.location.href}`;
            if (navigator.share) {
                navigator.share({ title: '–ú–æ—è –Ω–µ–¥–µ–ª—è –∫–∞–∫...', text: shareText });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –í—Å—Ç–∞–≤—å –≤ —á–∞—Ç –∏–ª–∏ —Å—Ç–æ—Ä–∏—Å ‚úÖ");
                }).catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                });
            }
        }

        startButton.addEventListener('click', () => {
            startButton.style.display = 'none';
            showNextImage();
        });
    </script>
</body>
</html>